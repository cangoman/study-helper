<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Home Page</title>


    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    
  </head>

  <body class="container">
    <h1>La Pati's Study helper</h1>
    <input id="file-input" class="" type="file"></input>
    <button id="use-another" class='btn btn-primary d-none'>Use another file</button>

    <div class="card mt-2">
      <div class="card-header">
      </div>

      <div class='card-body'>
      </div>
      

      <div class="card-footer">
        <div id="buttons" class="d-none">
          <button class="btn btn-primary answer-button" type="button">Show answer</button>
          <button class="btn btn-secondary next-button" type="button">Next question</button>
        </div>
      </div>
    </div>


  </body>

  <script>
  const nextQuestion = (questions) => {
    const nextIndex = Math.floor(Math.random() * questions.length);
    return questions[nextIndex]
  }

  const displayQuestion = (question) => {
      $('.card-body').html(`<div id='question'></div>
      <div id='answer' class='d-none'></div>`)
    if (typeof question === 'string'){
      q_a = question.split(',')
      $('#question').html(`<p>${q_a[0]}</p>`)
      $('#answer').html(`<p>${q_a[1]}</p>`)
    }
  }

  $(() => {
      var questions = '';
      var current_question = '';
      var next_question = '';

      $('#file-input').on('change', (e) => {
        //reading the file
        var file = $("#file-input")[0].files[0];
        
        if (file) {
          var textType = /text.*/;
  
          if (file.type.match(textType)) {
            var reader = new FileReader();
  
            // event listeners for the reader
            reader.addEventListener('loadstart', () => {
              $('.card .card-body').html(`<div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
              </div>`)
            })
            reader.addEventListener('loadend', () => {
              $('#file-input, #use-another, #buttons').toggleClass('d-none');
              $('#use-another').on('click', () => {
                $('#use-another, #file-input').toggleClass('d-none')
              })
              $('.card .card-body').html(`<button class='btn btn-primary btn-lg begin'>Begin</button>`);
              $('.card-header').html(`Using file: ${file.name}`);
              $('.begin').on('click',() => {
                current_question = nextQuestion(questions);
                displayQuestion(current_question);
              });
              
              $('.next-button').on('click', () => {
                do {
                  next_question = nextQuestion(questions);
                } while (next_question === current_question)
                
                displayQuestion(next_question);
                current_question = next_question;
              })
              $('.answer-button').on('click', () => {
                $('#answer').toggleClass('d-none')
                if ($('#answer').hasClass('d-none')) {
                  $('.answer-button').html('Show Answer')
                } else {
                  $('.answer-button').html('Hide Answer')
                }
              })
            })
            
            reader.onload = function(e) {
              questions = reader.result;
              var regex = new RegExp('[\r]+')
              questions = questions.split(regex)
            }
          
            reader.readAsText(file)
          } else {
            $('.card-body').html("Something's wrong with that file")
          }
          
          

        }
      });

      
  })

  </script>
</html>
